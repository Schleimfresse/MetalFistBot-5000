if (commandName === "add") {
		const url = options.getString("url");
		const guildId = interaction.guildId;

		const channel = interaction.member.voice.channel;
		if (!channel) return interaction.reply("You are not connected to a voice channel!");

		await interaction.deferReply();

		try {
			const connection = joinVoiceChannel({
				channelId: channel.id,
				guildId: channel.guild.id,
				adapterCreator: channel.guild.voiceAdapterCreator,
			});

			const stream = ytdl(url, { filter: "audioonly" });
			const resource = createAudioResource(stream);
			const player = createAudioPlayer();

			connection.subscribe(player);
			player.play(resource);

			player.on("stateChange", (oldState, newState) => {
				if (newState.status === "idle") {
					connection.destroy();
				}
			});

			await interaction.editReply(`Now playing: ${url}`);
		} catch (error) {
			console.error(error);
			await interaction.editReply("Failed to play the track.");
		}
	}